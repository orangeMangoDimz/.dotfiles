// Zed keymap
//
// For information on binding keys, see the Zed
// documentation: https://zed.dev/docs/key-bindings
//
// To see the default key bindings run `zed: open default keymap`
// from the command palette.
[
    // ============================================================================
    // Global Bindings (Apply to all contexts)
    // ============================================================================
    {
        "bindings": {
            // Vim-style pane navigation using Ctrl + hjkl
            "ctrl-h": "workspace::ActivatePaneLeft",    // Move to left pane
            "ctrl-l": "workspace::ActivatePaneRight",   // Move to right pane
            "ctrl-k": "workspace::ActivatePaneUp",      // Move to upper pane
            "ctrl-j": "workspace::ActivatePaneDown",    // Move to lower pane

            // Resize docked panels (sidebars)
            "shift-alt-l": "workspace::IncreaseOpenDocksSize",  // Make docks wider
            "shift-alt-h": "workspace::DecreaseOpenDocksSize"   // Make docks narrower
        }
    },

    // ============================================================================
    // Workspace Navigation
    // ============================================================================
    {
        "context": "Workspace",
        "bindings": {
            // Vim-style pane navigation (same as global)
            "ctrl-h": "workspace::ActivatePaneLeft",
            "ctrl-l": "workspace::ActivatePaneRight",
            "ctrl-k": "workspace::ActivatePaneUp",
            "ctrl-j": "workspace::ActivatePaneDown",

            // Dock size adjustment
            "shift-alt-l": "workspace::IncreaseOpenDocksSize",
            "shift-alt-h": "workspace::DecreaseOpenDocksSize",

            // Toggle left sidebar (agent/collaboration panels)
            "alt-l": "workspace::ToggleLeftDock"
        }
    },

    // ============================================================================
    // Vim Mode - Normal
    // ============================================================================
    {
        "context": "vim_mode == normal && !menu",
        "bindings": {
            // === DEBUGGING ===
            "space b t": "editor::ToggleBreakpoint",  // Toggle breakpoint on current line

            // === VIM MOTION OVERRIDES ===
            "j": ["vim::Down", { "display_lines": true }],  // Move down by display lines (respects soft wrap)
            "k": ["vim::Up", { "display_lines": true }],    // Move up by display lines (respects soft wrap)

            // === FILE OPERATIONS (Space + F) ===
            "space f f": "file_finder::Toggle",             // Find file (fuzzy search)
            "space f w": "pane::DeploySearch",              // Search in workspace (find/replace)
            "space f m": "editor::Format",                  // Format current file
            "space f c": "project_panel::CollapseAllEntries",  // Collapse all folders in project panel

            // === CODE ACTIONS (Space + C) ===
            "space c a": "editor::ToggleCodeActions",  // Show available code actions (quick fixes)
            "space c r": "editor::Rename",             // Rename symbol under cursor
            "space c d": "diagnostics::Deploy",        // Show diagnostics panel (errors/warnings)

            // === EXPLORER/PANELS (Space + E) ===
            "space e t": "workspace::ToggleRightDock",     // Toggle right dock (project panel + outline)
            "space e e": "project_panel::ToggleFocus",     // Toggle focus on project explorer
            "space e p": "outline::Toggle",                // Toggle outline panel (symbols)

            // === WINDOW MANAGEMENT (Space + H/V/X/W) ===
            "space h": "pane::SplitRight",          // Split pane horizontally (new pane on right)
            "space v": "pane::SplitDown",           // Split pane vertically (new pane below)
            "space x": "pane::CloseActiveItem",     // Close current file/tab
            // "space d b": "pane::CloseAllItems",  // (Commented) Close all tabs in pane
            "space w w": "editor::ToggleSoftWrap",  // Toggle soft line wrapping

            // === PANE RESIZING ===
            "alt-shift-l": "vim::ResizePaneRight",  // Expand pane to the right
            "alt-shift-h": "vim::ResizePaneLeft",   // Expand pane to the left

            // === AI AGENT (Space + A) ===
            "space a t": "agent::NewThread",  // Start new AI agent conversation

            // === NAVIGATION (G prefix) ===
            "g b": "pane::GoBack",                   // Go back to previous location
            "g r": "editor::FindAllReferences",      // Find all references to symbol

            // Vim-style pane navigation
            "ctrl-h": "workspace::ActivatePaneLeft",
            "ctrl-l": "workspace::ActivatePaneRight",
            "ctrl-k": "workspace::ActivatePaneUp",
            "ctrl-j": "workspace::ActivatePaneDown",

            // === ERROR NAVIGATION (Bracket prefix) ===
            "] e": "editor::GoToDiagnostic",          // Go to next error/warning
            "[ e": "editor::GoToPreviousDiagnostic",  // Go to previous error/warning

            // === GIT - HUNK NAVIGATION (Bracket + H) ===
            "] h": "editor::GoToHunk",          // Go to next git change (hunk)
            "[ h": "editor::GoToPreviousHunk",  // Go to previous git change (hunk)

            // === GIT - ACTIONS (Space + G + H) ===
            "space g h d": "editor::ToggleSelectedDiffHunks",  // Toggle diff view for selected hunks
            "space g h r": "git::Restore",                     // Restore/discard changes
            "space g h f": "git_panel::ToggleFocus",           // Focus git panel

            // === MARKDOWN (Space + M) ===
            "space m p": "markdown::OpenPreview",           // Open markdown preview (in-place)
            "space m P": "markdown::OpenPreviewToTheSide",  // Open markdown preview (side-by-side)

            // === NOTIFICATIONS (Space + N) ===
            "space n c": "workspace::ClearAllNotifications",  // Clear all notifications

            // Toggle left sidebar
            "alt-l": "workspace::ToggleLeftDock"
        }
    },

    // ============================================================================
    // Vim Mode - Visual
    // ============================================================================
    {
        "context": "vim_mode == visual && !menu",
        "bindings": {
            // Move selected lines up/down
            "shift-j": "editor::MoveLineDown",  // Move selection down
            "shift-k": "editor::MoveLineUp",    // Move selection up

            // Sneak motion plugin (two-character search)
            "s": ["vim::PushSneak", {}],          // Sneak forward
            "S": ["vim::PushSneakBackward", {}]   // Sneak backward
        }
    },

    // ============================================================================
    // Vim Mode - Insert
    // ============================================================================
    {
        "context": "vim_mode == insert",
        "bindings": {
            // Uncomment to enable jj to exit insert mode (common Vim customization)
            // "j j": "vim::NormalBefore"
        }
    },

    // ============================================================================
    // Terminal
    // ============================================================================
    {
        "context": "Terminal",
        "bindings": {
            // Pane navigation (same as Vim mode)
            "ctrl-h": "workspace::ActivatePaneLeft",
            "ctrl-l": "workspace::ActivatePaneRight",
            "ctrl-k": "workspace::ActivatePaneUp",
            "ctrl-j": "workspace::ActivatePaneDown",

            // Navigate between terminal tabs
            "ctrl-shift-j": "pane::ActivateNextItem",      // Next terminal tab
            "ctrl-shift-k": "pane::ActivatePreviousItem",  // Previous terminal tab

            // Toggle fullscreen/zoom for terminal
            "ctrl-shift-f": "workspace::ToggleZoom",

            // Disable default terminal toggle keybinding
            "alt-t": null
        }
    },

    // ============================================================================
    // Project Panel (File Explorer)
    // ============================================================================
    {
        "context": "ProjectPanel && not_editing",
        "bindings": {
            // File/folder operations (Vim-style)
            "a": "project_panel::NewFile",       // Add new file
            "A": "project_panel::NewDirectory",  // Add new directory/folder
            "r": "project_panel::Rename",        // Rename file/folder
            "d": "project_panel::Delete",        // Delete file/folder
            "x": "project_panel::Cut",           // Cut file/folder
            "c": "project_panel::Copy",          // Copy file/folder
            "p": "project_panel::Paste",         // Paste file/folder

            // Close project panel (since it's on the right)
            "q": "workspace::ToggleRightDock",
            "space e t": "workspace::ToggleRightDock",

            // Navigate between panels from project panel
            "ctrl-h": "workspace::ActivatePaneLeft",
            "ctrl-l": "workspace::ActivatePaneRight",
            "ctrl-k": "workspace::ActivatePaneUp",
            "ctrl-j": "workspace::ActivatePaneDown",

            // Open file and close panel in one keystroke
            "enter": ["workspace::SendKeystrokes", "enter space e t"]
        }
    },

    // ============================================================================
    // Editor (Full Mode)
    // ============================================================================
    {
        "context": "(Editor && mode == full)",
        "bindings": {
            // Empty - placeholder for future editor-specific bindings
        }
    },

    // ============================================================================
    // Agent Panel - Base Context
    // ============================================================================
    {
        "context": "AgentPanel",
        "bindings": {
            // Create new external agent thread (Claude Code)
            "alt-t": [
                "agent::NewExternalAgentThread",
                { "agent": "claude_code" }
            ]
        }
    },

    // === Agent Panel - Prompt Editor Context ===
    {
        "context": "(AgentPanel && prompt_editor)",
        "bindings": {
            "alt-t": "agent::NewThread",  // New thread from prompt editor
            "ctrl-alt-t": null            // Disable default binding
        }
    },

    // === Agent Panel - External Agent Thread Context ===
    {
        "context": "(AgentPanel && external_agent_thread)",
        "bindings": {
            "alt-t": "agent::NewThread",  // New thread in external agent
            "ctrl-alt-t": null            // Disable default binding
        }
    },

    // === Agent Panel - ACP Thread Context ===
    {
        "context": "(AgentPanel && acp_thread)",
        "bindings": {
            "ctrl-alt-t": null  // Disable default binding
        }
    },

    // === Agent Panel - Text Thread Context ===
    {
        "context": "(AgentPanel && text_thread)",
        "bindings": {
            "ctrl-alt-t": null  // Disable default binding
        }
    },

    // === Agent Panel - Additional Controls ===
    {
        "context": "AgentPanel",
        "bindings": {
            "alt-h": "agent::OpenHistory",           // Open agent conversation history
            "alt-f": "agent::ExpandMessageEditor",   // Expand message editor (full screen)

            // Disable default bindings
            "ctrl-alt-/": null,
            "ctrl-shift-h": null,
            "alt-shift-escape": null
        }
    },

    // === Agent Panel - Message Editor ===
    {
        "context": "((AgentPanel || ContextEditor) || MessageEditor > Editor)",
        "bindings": {
            "alt-m": "agent::ToggleModelSelector",  // Switch AI model
            "alt-shift-t": "agent::NewThread",      // New thread

            // Disable default bindings
            "ctrl-/": null,
            "ctrl-r": null
        }
    },

    // ============================================================================
    // File Finder & Search
    // ============================================================================

    // === File Finder Context ===
    {
        "context": "((FileFinder || FileFinder > Picker > Editor) || FileFinder > Picker > menu)",
        "bindings": {
            // Keep ctrl-h disabled in file finder to allow backspace-like behavior
            // This prevents conflict with text editing in the fuzzy finder
            // "ctrl-h": null
        }
    },

    // === Buffer Search Bar Context ===
    {
        "context": "BufferSearchBar",
        "bindings": {
            // Keep ctrl-h disabled in search bar to allow backspace-like behavior
            // This prevents conflict with text editing in the search field
            // "ctrl-h": null
        }
    },

    // ============================================================================
    // Non-Terminal Contexts (Global Override)
    // ============================================================================
    {
        "context": "!Terminal",
        "bindings": {
            // Ensure pane navigation works everywhere except terminal
            "ctrl-h": "workspace::ActivatePaneLeft",
            "ctrl-l": "workspace::ActivatePaneRight",
            "ctrl-k": "workspace::ActivatePaneUp",
            "ctrl-j": "workspace::ActivatePaneDown",

            // Disable default copy binding
            "ctrl-shift-c": null
        }
    },

    // ============================================================================
    // Editor-Specific Overrides
    // ============================================================================
    {
        "context": "Editor",
        "bindings": {
            // Disable F9 (typically used for debugging)
            "f9": null
        }
    }
]

